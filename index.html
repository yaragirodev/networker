<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>networker</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background: #f5f5f5;
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
        }
        #speedtest {
            background: white;
            padding: 2rem;
            border-radius: 12px;
            box-shadow: 0 2px 12px #0001;
            text-align: center;
            width: 300px;
        }
        button {
            padding: 0.6rem 1.5rem;
            font-size: 1.1rem;
            border-radius: 6px;
            border: none;
            background: #006eff;
            color: white;
            cursor: pointer;
            transition: background 0.3s;
        }
        button:disabled {
            background: #aaa;
            cursor: not-allowed;
        }
        h2 {
            margin-bottom: 0.5rem;
        }
        .result {
            margin-top: 1rem;
            font-size: 1.1rem;
        }
        #progressBar {
            height: 8px;
            width: 100%;
            background: #eee;
            border-radius: 4px;
            margin-top: 1rem;
            overflow: hidden;
        }
        #progressBarFill {
            height: 100%;
            width: 0;
            background: #006eff;
            transition: width 0.2s;
        }
    </style>
</head>
<body>
    <div id="speedtest">
        <h2>networker</h2>
        <button id="startBtn">Start Test</button>
        <div id="progressBar"><div id="progressBarFill"></div></div>
        <div class="result" id="status"></div>
        <div class="result" id="speed"></div>
    </div>
    <script>
        const testFileUrl = "https://raw.githubusercontent.com/yaragirodev/networker/main/bin/5mb_file.bin";
        const startBtn = document.getElementById('startBtn');
        const statusDiv = document.getElementById('status');
        const speedDiv = document.getElementById('speed');
        const progressBarFill = document.getElementById('progressBarFill');

        function formatSpeed(mbps) {
            return mbps >= 1 
                ? mbps.toFixed(2) + " Mbps"
                : (mbps * 1000 / 8).toFixed(2) + " KB/s";
        }

        async function runSpeedTest() {
            startBtn.disabled = true;
            startBtn.textContent = 'Testing...';
            statusDiv.textContent = "Testing...";
            speedDiv.textContent = '';
            progressBarFill.style.width = '0';

            try {
                const startTime = performance.now();
                const response = await fetch(testFileUrl, { cache: 'no-store' });
                const reader = response.body.getReader();
                const contentLength = +response.headers.get("Content-Length");
                let received = 0;

                while (true) {
                    const { done, value } = await reader.read();
                    if (done) break;
                    received += value.length;
                    if (contentLength) {
                        const percent = (received / contentLength) * 100;
                        progressBarFill.style.width = percent.toFixed(2) + "%";
                    }
                }

                const endTime = performance.now();
                const duration = (endTime - startTime) / 1000;
                const bitsLoaded = received * 8;
                const mbps = (bitsLoaded / duration) / (1024 * 1024);

                statusDiv.textContent = `Downloaded ${(received / 1024 / 1024).toFixed(2)} MB in ${duration.toFixed(2)} seconds.`;
                speedDiv.textContent = `Speed: ${formatSpeed(mbps)}`;
            } catch (e) {
                statusDiv.textContent = '‚ùå Error during speed test.';
                speedDiv.textContent = '';
            } finally {
                startBtn.disabled = false;
                startBtn.textContent = 'Start Test';
            }
        }

        startBtn.addEventListener('click', runSpeedTest);
    </script>
</body>
</html>
